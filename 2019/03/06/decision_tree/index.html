<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="0.1. ID3熵：随机变量的不确定性，越不确定的事物，它的熵就越大。H(X) &#x3D; -\sum\limits_{i&#x3D;1}^{n}p_i logp_i 条件熵：H(X|Y) &#x3D; -\sum\limits_{i&#x3D;1}^{n}p(x_i,y_i)logp(x_i|y_i) &#x3D; \sum\limits_{j&#x3D;1}^{n}p(y_j)H(X|y_j) 信息增益Information Gain：IG(X,Y)">
<meta property="og:type" content="article">
<meta property="og:title" content="决策树">
<meta property="og:url" content="http://yoursite.com/2019/03/06/decision_tree/index.html">
<meta property="og:site_name" content="Hardcore Coder">
<meta property="og:description" content="0.1. ID3熵：随机变量的不确定性，越不确定的事物，它的熵就越大。H(X) &#x3D; -\sum\limits_{i&#x3D;1}^{n}p_i logp_i 条件熵：H(X|Y) &#x3D; -\sum\limits_{i&#x3D;1}^{n}p(x_i,y_i)logp(x_i|y_i) &#x3D; \sum\limits_{j&#x3D;1}^{n}p(y_j)H(X|y_j) 信息增益Information Gain：IG(X,Y)">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-03-05T16:00:00.000Z">
<meta property="article:modified_time" content="2019-03-05T16:00:00.000Z">
<meta property="article:author" content="骚炼">
<meta name="twitter:card" content="summary">






  <link rel="canonical" href="http://yoursite.com/2019/03/06/decision_tree/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>决策树 | Hardcore Coder</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/wcfrank" target="_blank" rel="noopener" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hardcore Coder</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/06/decision_tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="骚炼">
      <meta itemprop="description" content="我爱七月">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hardcore Coder">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">决策树
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-06 00:00:00" itemprop="dateCreated datePublished" datetime="2019-03-06T00:00:00+08:00">2019-03-06</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="ID3">0.1. ID3</h2><p>熵：随机变量的不确定性，越不确定的事物，它的熵就越大。<script type="math/tex">H(X) = -\sum\limits_{i=1}^{n}p_i logp_i</script></p>
<p>条件熵：<script type="math/tex">H(X|Y) = -\sum\limits_{i=1}^{n}p(x_i,y_i)logp(x_i|y_i) = \sum\limits_{j=1}^{n}p(y_j)H(X|y_j)</script></p>
<p>信息增益Information Gain：IG(X,Y) = H(X)-H(X|Y). 这里X指label，Y指某个特征。信息增益（IG）是描述某一个特征属性的存在与否，对总体信息熵的<strong>变化量</strong>影响。</p>
<p><strong>ID3递归建树：</strong> 假设当前节点，有数据集D和属性集合{A}。计算D的所有属性<script type="math/tex">A_i</script>的IG，选择IG最大的属性进行分裂，子节点个数为该属性所有取值（即完全分裂）。停止分裂条件：节点的数据集属于同一类，D的所有特征均相同，IG小于阈值。</p>
<p>ID3模型：</p>
<ul>
<li>只能处理类别数据，即离散数据</li>
<li>节点分裂的时候，分裂所有的值</li>
</ul>
<h2 id="C4-5">0.2. C4.5</h2><p>针对ID3的缺点，C4.5的改进：</p>
<ul>
<li>选择特征的时候用信息增益比代替信息增益</li>
<li>能够处理连续值特征</li>
<li>能够处理缺失值特征</li>
<li>剪枝</li>
</ul>
<h3 id="信息增益比">0.2.1. 信息增益比</h3><p>信息增益比Information Gain Ratio：信息增益和特征熵的比值。特征熵又叫Split Information，$IGR(D,A) = \frac{IG(D,A)}{H_A(D)}$</p>
<p>通过 IG 的公式可以推测出，当子树固定时，总的信息熵固定，只要条件熵（就是某一特征属性的信息熵）越小，那么 IG 的值就越大。通过条件熵的计算公式，如果某一个属性的取值越多，那么这个条件熵的值就会越小。从而，选择 IG 最大的属性，可以理解成选择取值较多的属性。</p>
<p>条件熵记为${SplitInfo= -\sum_i{p(v_i)}log_2{p(v_i)}}$，其中$v_i$为某一特征属性下的第$i$个分支属性。注意，在求信息增益的时候，是计算样本label的概率，特征熵是计算某属性所有取值的概率。</p>
<p>特征属性取值多，特征熵会比较大，所以信息增益比可以修正信息增益的偏差。比如连续值属性，不同的特征取值可能会非常多，这个时候就需要采用信息增益比来选择特征进行分裂。</p>
<h3 id="处理连续值">0.2.2. 处理连续值</h3><p>C4.5处理离散值的方式与ID3一样，分支数是所有的不同取值个数，即完全分裂；<strong>对于连续值，分支数是二叉树</strong>。所以对于连续值的属性，在子树选特征的时候还可以被使用；离散特征不会，因为一旦分裂了，子树的该特征都取值相同，$IG=0$.</p>
<h4 id="选分裂的值">0.2.2.1. 选分裂的值</h4><p>首先，连续属性离散化：先对连续值进行排序，然后相邻的两个点取中间值作为分裂点的集合，N个值有N-1个分裂点，对每个分裂点&lt;=和&gt;做二叉分裂。另外可优化的是，对排好序的特征，只有在label发生改变（即label发生了变化）的地方才需要分裂，这可以显著减少运算量[2]。</p>
<p>然后，如何从这至多N-1个分裂点选出最优的那个呢？经证明，在决定连续特征的分界点时采用IG这个指标。因为若采用信息增益率，特征熵影响分裂点信息度量准确性，若某分界点恰好将连续属性分成数目相等的两部分时，特征熵最大，对IGR的影响最大。二叉树使用IGR会倾向于等分，所以我们改用IG来计算，每一种分裂方法，计算两个分支的IG之和。反过来考虑，二叉树的时候分支数被限定为2，所以IG无法倾向于选择取值多的方案。</p>
<h4 id="选属性">0.2.2.2. 选属性</h4><p>C4.5在选择哪个属性进行分裂的时候，则是通过Information Gain Ratio来选择。对于离散的属性，跟ID3没有大区别；对于连续变量的特征，IGR是所有不同的连续值都考虑进去。例如一颗子树是这样的：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>temperature</th>
<th>2</th>
<th>2</th>
<th>2</th>
<th>3</th>
<th>3</th>
<th>6</th>
<th>7</th>
<th>7</th>
<th>7</th>
<th>7</th>
</tr>
</thead>
<tbody>
<tr>
<td>label</td>
<td>n</td>
<td>n</td>
<td>y</td>
<td>n</td>
<td>n</td>
<td>y</td>
<td>n</td>
<td>y</td>
<td>y</td>
<td>y</td>
</tr>
</tbody>
</table>
</div>
<p>温度可理解为连续值，尽管这里是integer格式，这个特征的<script type="math/tex">IGR = \frac{IG}{SplitInfo}</script>，<script type="math/tex">H(X)=-(\frac{5}{10}*\log\frac{5}{10}+\frac{5}{10}*\log\frac{5}{10})</script>，<script type="math/tex">H(X|T)=\frac{3}{10}(-\frac{2}{3}\log\frac{2}{3}-\frac{1}{3}\log\frac{1}{3}) + \frac{2}{10}(-1\log1-0\log0) + \frac{1}{10}(-1\log1) + \frac{4}{10}(-\frac{1}{4}\log\frac{1}{4}-\frac{3}{4}\log\frac{3}{4})</script>，</p>
<p>假设分解特征为&lt;=2和&gt;2通过上节求得是最优的（IG最大），$SplitInfo(T)=-(\frac{3}{10}\log\frac{3}{10} + \frac{7}{10}\log\frac{7}{10} )$。以上就是这颗子树的温度属性的IGR，我们把所有的属性的IGR都求一遍（无论离散、连续），找到IGR最大的那个即为要进行分裂的属性。</p>
<p><strong>选择连续属性的哪个分界点，用IG来比较；求得每个连续属性的最优分界点之后，再用IGR来比较属性之间哪个最优。</strong></p>
<h4 id="对连续属性的处理如下-2">0.2.2.3. 对连续属性的处理如下[2]</h4><ol>
<li>对特征的取值进行升序排序</li>
<li>两个特征取值之间的中点作为可能的分裂点，将数据集分成两部分，计算每个可能的分裂点的信息增益。优化算法就是只计算分类属性发生改变的那些特征取值</li>
<li>选择修正后信息增益最大的分裂点作为<strong>该特征的最佳分裂点</strong></li>
<li>计算最佳分裂点的信息增益率（Gain Ratio）作为特征的Gain Ratio。注意，此处需对最佳分裂点的信息增益进行修正：减去log2(N-1)/|D|（N是连续特征的取值个数，D是训练数据数目，此修正的原因：当离散属性和连续属性并存时，C4.5算法倾向于选择连续特征做最佳树分裂点）</li>
</ol>
<h3 id="处理缺失值">0.2.3. 处理缺失值</h3><h4 id="选择属性时">0.2.3.1. 选择属性时</h4><p>假设10个样本，属性是a,b,c。在计算a属性熵时发现，第10个样本的a属性缺失，那么就把第10个样本去掉，前9个样本组成新的样本集，在新样本集上按正常方法计算a属性的IG，然后结果乘0.9（不含缺失值样本占原始样本的比例），就是a属性最终的IG，即$Gain = ratio*(H(X) - H(X|Y))$ 。求IGR时，<script type="math/tex">SplitInfo(a) = -\sum_{i=1}^k \frac{|S_i|}{|S|}log_2\frac{|S_i|}{|S|} - \frac{|S_{unknow}|}{|S|}log_2\frac{|S_{unknow}|}{|S|}</script>，其中$S_{unknow}$是含缺失值的数据组成的样本集。[3]</p>
<h4 id="以概率分裂缺失样本">0.2.3.2. 以概率分裂缺失样本</h4><p>确定了当前子树的分裂方式（属性+分界点），才会知道子节点样本的数量。把缺失值按照子节点样本出现的概率，分配到各个子节点。</p>
<p>还是上面那个温度的例子，这个子树有10个<strong>无缺失值</strong>的样本，假设选定了温度属性，并按照温度属性&lt;=2和&gt;2为特征，划分了两个子树；假设另外有3个温度有缺失的样本，每个样本按照3/10的权重安排到&lt;=2的子树，7/10的权重安排到&gt;2的子树，其他的10个样本的权重为1。这样后续在算熵的时候，部分样本就带着权重算罢了。</p>
<h4 id="剪枝">0.2.3.3. 剪枝</h4><p>[4]介绍了一点简单的简直方法；另外C4.5主要采用后剪枝中的悲观剪枝法。</p>
<h3 id="C4-5模型的特点：">0.2.4. C4.5模型的特点：</h3><ul>
<li>多叉树</li>
<li>只能用于分类</li>
<li>熵模型有对数运算，耗时；处理连续值时要排序，耗时</li>
</ul>
<h2 id="CART">0.3. CART</h2><p>针对C4.5的缺点，CART的改进：[5]</p>
<ul>
<li>简化为二叉树</li>
<li>可以处理分类，也可以处理回归</li>
<li>使用Gini系数来代替信息增益率，不再使用复杂度高的熵模型</li>
</ul>
<h3 id="Gini系数">0.3.1. Gini系数</h3><p>在<strong>分类问题</strong>中，假设有K个类别，第k个<strong>label</strong>的概率为<script type="math/tex">p_k</script>, 则基尼系数的表达式为<script type="math/tex">Gini(p) = \sum\limits_{k=1}^{K}p_k(1-p_k) = 1- \sum\limits_{k=1}^{K}p_k^2</script>. 如果是二类分类问题，如果属于第一个样本<strong>label</strong>的概率是p，则基尼系数的表达式为$Gini(p) = 2p(1-p)$. 给定样本D，Gini系数为<script type="math/tex">Gini(D) = 1-\sum\limits_{k=1}^{K}(\frac{|C_k|}{|D|})^2</script>，其中$C_k$是D中属于第k类的样本集合；<script type="math/tex">Gini(D,A) = \frac{|D_1|}{|D|}Gini(D_1) + \frac{|D_2|}{|D|}Gini(D_2)</script>，其中A表示按照某一个特征进行二元分裂，得到子集D1和D2。Gini(D)表示样本D的不确定性，Gini(D,A)表示按照特征A分裂后样本的不确定性。</p>
<p>比较下基尼系数表达式和熵模型的表达式，二次运算比对数简单很多，基尼系数可以做为熵模型的一个近似替代。Gini系数越大，样本不确定性越大。CART分类树算法就是使用的基尼系数来选择决策树的特征。</p>
<p>为了进一步简化，CART分类树算法每次仅仅对某个特征的值进行二分，而不是多分，这样CART分类树算法建立起来的是二叉树，而不是多叉树，可以进一步简化基尼系数的计算。</p>
<h3 id="CART分类树">0.3.2. CART分类树</h3><ul>
<li><p>CART分类树连续值的处理，思想和C4.5相同，都是将连续的特征离散化。唯一的区别在于在选择划分点时的度量方式不同，C4.5使用的是IG，则CART分类树使用的是基尼系数。对于某个连续值属性，同样也是先排序然后离散化，对每个划分点t做二元分类（&lt;=t，&gt;t），<strong>选择Gini系数最小的点</strong>。如果当前节点为连续属性，则该属性后面还可以参与子节点的产生选择过程。</p>
</li>
<li><p>CART分类树离散值的处理，采用的思路是不停的二分离散特征。因为每个节点都是二叉树，所以离散特征一次不会完全分裂，因此后面还有机会在子节点继续选择这个特征。但在ID3和C4.5中，离散属性都是完全分裂，只会参与一次节点的建立。</p>
</li>
</ul>
<p><strong>CART分类树的步骤：</strong> 从根节点开始，用训练集递归的建立CART树。</p>
<ol>
<li>对于当前节点的数据集为D，如果样本个数小于阈值、或者没有特征、或者样本集D的基尼系数$Gini(D)$小于阈值，则返回决策树子树，当前节点停止递归。</li>
<li>计算当前节点现有的<strong>各个特征</strong>的<strong>各个特征值</strong>对数据集D的基尼系数$Gini(D,A)$。缺失值的处理方法和C4.5算法相同。</li>
<li>在计算出来的各个特征的各个特征值对数据集D的基尼系数中，选择基尼系数最小的特征A和对应的特征值a。根据这个最优特征和最优特征值，把数据集划分成两部分D1和D2，同时建立当前节点的左右节点，做节点的数据集D为D1，右节点的数据集D为D2.</li>
<li>对左右的子节点递归的调用1-4步，生成决策树。</li>
<li>采用叶子节点里概率最大的类别作为当前节点的预测类别。</li>
</ol>
<p><strong>注意</strong>，算法计算Gini系数的时候，用到的是两种Gini系数：</p>
<ul>
<li>$Gini(D,A)$用于选择特征和分裂点；</li>
<li>$Gini(D)$用于计算$Gini(D,A)$子集的值，以及判断当前节点是否满足停止递归的条件</li>
</ul>
<p>具体例子参考李书[6]</p>
<h3 id="CART回归树">0.3.3. CART回归树</h3><p>CART回归树和CART分类树大部分类似，所以这里只讨论CART回归树和CART分类树不同之处：</p>
<ul>
<li>连续值的处理方法不同。不使用Gini系数，而是用和方差来度量。对于任意属性A，对应的任意划分点s两边划分成的数据集D1和D2，求出使D1和D2各自集合的均方差最小，同时D1和D2的均方差之和最小所对应的特征和特征值划分点：<script type="math/tex">\underbrace{min}_{A,s}\Bigg[\underbrace{min}_{c_1}\sum\limits_{x_i \in D_1(A,s)}(y_i - c_1)^2 + \underbrace{min}_{c_2}\sum\limits_{x_i \in D_2(A,s)}(y_i - c_2)^2\Bigg]</script>，其中x为样本，y为样本的输出值，c1为D1数据集的样本输出均值，c2为D2数据集的样本输出均值。</li>
<li>决策树建立后做预测的方式不同。回归树输出不是类别，它采用的是用最终叶子的均值或者中位数来预测输出结果。</li>
</ul>
<h3 id="CART的剪枝">0.3.4. CART的剪枝</h3><p>决策树算法容易对训练集过拟合，CART树进行剪枝，增加决策树的泛化能力。CART采用Cost-Complexity Pruning (CCP):</p>
<ol>
<li>从生成好的决策树（记为$T_0$）的底端开始，不断剪枝，直到$T_0$的根节点为止，得到一个子树序列<script type="math/tex">\{T_0, T_1, \dots,T_n\}</script>；</li>
<li>交叉验证，在独立的验证集合上对子树序列测试，从中选择最优子树。</li>
</ol>
<h4 id="剪枝-得到子树序列">0.3.4.1. 剪枝-得到子树序列</h4><p>定义损失函数为$C_\alpha(T) = C(T) + \alpha|T|$，其中T为任意子树，C(T)为训练集的预测误差（如Gini系数），|T|为子树叶子节点的个数，$\alpha$为正则化参数，$C_a(T)$是子树复杂度有关的损失函数。</p>
<p>对固定的$\alpha$，一定存在使得损失函数<script type="math/tex">C_{\alpha}(T)</script>最小的子树（记为<script type="math/tex">T_{\alpha}</script>），这个最优子树是唯一的。</p>
<blockquote>
<p>经证明，用递归的方法对树进行剪枝，将<script type="math/tex">\alpha</script>从小增大，<script type="math/tex">0=\alpha_0<\alpha_1<\dots<\alpha_n, i=0,1,\dots,n</script>，区间<script type="math/tex">[\alpha_i,\alpha_{i+1})</script>对应着序列中的子树<script type="math/tex">T_i</script>，<script type="math/tex">i=0,1,\dots,n</script>. 序列中的子树是嵌套的。</p>
</blockquote>
<p>当$\alpha$很小，甚至等于0的时候，$T_0$即是最优；当$\alpha$增大，最优子树的规模变小；当$\alpha$很大时，单个根节点$T_n$是最优的。</p>
<p><strong>现在只知道$\alpha_0=0$和$T_0$，怎么找到序列$\alpha_1,\dots, \alpha_n$和$T_1,\dots, T_n$呢？</strong></p>
<p>从完整的树$T_0$开始，对$T_0$的任意内部结点t，作为剪枝的候选：</p>
<p>如果以t为单节点树，<script type="math/tex">C_{\alpha}(t) = C(t) + \alpha</script>；以t为根节点的子树，<script type="math/tex">C_{\alpha}(T_t) = C(T_t) + \alpha|T_t|</script>.</p>
<p>参数$\alpha$的临界点为$\alpha = \frac{C(t)-C(T_t)}{|T_t|-1}$，这时子树$T_t$跟单节点t的损失函数一样，而t节点更少，所以t比$T_t$更可取，从$T_0$上把$T_t$剪掉只保留t. </p>
<p>对每个$T_0$上的内部节点都计算$g(t) = \frac{C(t)-C(T_t)}{|T_t|-1}$，在$T_0$上剪去$g(t)$最小的以$t$为根结点的子树，得到$T_1$，并另$\alpha_1 = g(t)$。$T_1$为区间$[\alpha_1,\alpha_2)$的最优子树！</p>
<p>重复此操作，直到得到根节点。</p>
<p><strong>对$\alpha$的理解</strong></p>
<p>剪枝的度量是损失函数<script type="math/tex">C_{\alpha}(T)</script>。剪不剪子树T，取决于<script type="math/tex">C_{\alpha}(T)</script>是否减小。不同的<script type="math/tex">\alpha</script>对应不同的剪枝方式，即剪掉不同的子树。那我们从0开始遍历<script type="math/tex">\alpha</script>，来得到不同的剪枝方案<script type="math/tex">\{T_0, T_1, \dots,T_n\}</script>。</p>
<p>注意，$C_{\alpha}(T)$是<strong>全局</strong>的一个损失函数。当$\alpha=\frac{C(t)-C(T_t)}{|T_t|-1}$时，在节点t处被剪枝时，误差增加了$C(t)-C(T_t)$；但树的复杂程度减少了$\alpha(|T_t|-1)$。可理解为，这时误差的增加量与复杂程度的减少量相抵。</p>
<p>另外，$\alpha$也是剪枝的阈值。对某节点t，当$\alpha=g(t)$时，剪和不剪对总体损失函数一样。如果$\alpha&gt;g(t)$，不剪的整体损失函数更大，应该剪；反之，$\alpha$小于$g(t)$就不该剪。损失函数可以对整个树，也可以是以t为根的子树（对t剪枝前后两者的增减是相同的）。</p>
<p><strong>为什么选择最小的$g(t)$为$\alpha_i$</strong></p>
<p>这个$g(t)$是剪枝的阈值。对同一颗树，$\alpha$从0开始增大，有某<strong>一颗树</strong>该剪，其他树不该剪，即$\alpha$达到了某个节点的$g(t)$但没有满足其他节点的$g(t)$。假设有多个内部节点<script type="math/tex">g(t_1)<g(t_2)<\dots</script>，如果选择剪枝<script type="math/tex">t_2</script>，<script type="math/tex">\alpha=g(t_2)</script>，这时剪不剪$t_2$总体损失函数相同，但是剪<script type="math/tex">t_1</script>比不剪<script type="math/tex">t_1</script>损失函数更小，所以剪掉<script type="math/tex">t_1</script>的子树也是一个剪枝方案，不要在剪<script type="math/tex">t_2</script>的子树之前遗漏<script type="math/tex">t_1</script>的子树。在剪掉<script type="math/tex">t_1</script>子树的基础上再剪掉<script type="math/tex">t_2</script>的子树，损失函数进一步减小，所以<script type="math/tex">\alpha\in[g(t_1), g(t_2))</script>时，子树<script type="math/tex">T_1</script>是最优的；但<script type="math/tex">\alpha</script>进一步增大<script type="math/tex">>g(t_2)</script>时，<script type="math/tex">T_2</script>就是最优的了。</p>
<p>所以$\alpha$从小开始意味着自下而上的剪枝。随着$\alpha$逐渐变大，不断的剪枝，得到子树序列 [8]。关键前面提到了：序列的子树是嵌套的！</p>
<ul>
<li><strong>这颗树$T_0$下所有的$g(t)$先只算一次</strong>。</li>
<li>选最小的$g(t)$，剪枝；</li>
<li>剪完剩下的$g(t)$中再选出最小的，再剪枝；……；</li>
<li>剪到只剩根节点为止。每次剪枝可能会剪掉多个节点，所以子树序列的个数n一般比内部结点数要少。</li>
</ul>
<h4 id="交叉验证得到最优子树">0.3.4.2. 交叉验证得到最优子树</h4><p>在验证数据集上，比较子树序列<script type="math/tex">\{T_0, T_1, \dots,T_n\}</script>，选出Gini系数或平方误差最小的子树。</p>
<h2 id="参考资料：">0.4. 参考资料：</h2><ol>
<li><a href="https://octaviansima.wordpress.com/2011/03/25/decision-trees-c4-5/" target="_blank" rel="noopener">https://octaviansima.wordpress.com/2011/03/25/decision-trees-c4-5/</a></li>
<li><a href="https://blog.csdn.net/shenxiaoming77/article/details/51602976" target="_blank" rel="noopener">C4.5 算法对于连续性属性的处理方法介绍</a></li>
<li><a href="https://www.quora.com/In-simple-language-how-does-C4-5-deal-with-missing-values" target="_blank" rel="noopener">https://www.quora.com/In-simple-language-how-does-C4-5-deal-with-missing-values</a></li>
<li><a href="https://blog.csdn.net/leaf_zizi/article/details/83380081" target="_blank" rel="noopener">机器学习笔记(6)C4.5决策树中的剪枝处理和Python实现</a></li>
<li><a href="http://www.cnblogs.com/pinard/p/6053344.html" target="_blank" rel="noopener">决策树算法原理(下)</a></li>
<li>李书</li>
<li><a href="https://zhuanlan.zhihu.com/p/30296061" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/30296061</a></li>
<li><a href="https://www.zhihu.com/question/22697086/answer/134841101" target="_blank" rel="noopener">https://www.zhihu.com/question/22697086/answer/134841101</a></li>
</ol>
<p>决策树overfitting比较的严重，一般要做boosting</p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/18/GBDT/" rel="next" title="GBDT">
                <i class="fa fa-chevron-left"></i> GBDT
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/17/BN_Dropout/" rel="prev" title="Batch Normalization & Dropout">
                Batch Normalization & Dropout <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">骚炼</p>
              <p class="site-description motion-element" itemprop="description">我爱七月</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/%20%7C%7C%20archive">
                
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/wcfrank" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:wangchao0519@hotmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ID3"><span class="nav-text">0.1. ID3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C4-5"><span class="nav-text">0.2. C4.5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#信息增益比"><span class="nav-text">0.2.1. 信息增益比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理连续值"><span class="nav-text">0.2.2. 处理连续值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#选分裂的值"><span class="nav-text">0.2.2.1. 选分裂的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#选属性"><span class="nav-text">0.2.2.2. 选属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#对连续属性的处理如下-2"><span class="nav-text">0.2.2.3. 对连续属性的处理如下[2]</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理缺失值"><span class="nav-text">0.2.3. 处理缺失值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#选择属性时"><span class="nav-text">0.2.3.1. 选择属性时</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#以概率分裂缺失样本"><span class="nav-text">0.2.3.2. 以概率分裂缺失样本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#剪枝"><span class="nav-text">0.2.3.3. 剪枝</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C4-5模型的特点："><span class="nav-text">0.2.4. C4.5模型的特点：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CART"><span class="nav-text">0.3. CART</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Gini系数"><span class="nav-text">0.3.1. Gini系数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CART分类树"><span class="nav-text">0.3.2. CART分类树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CART回归树"><span class="nav-text">0.3.3. CART回归树</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CART的剪枝"><span class="nav-text">0.3.4. CART的剪枝</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#剪枝-得到子树序列"><span class="nav-text">0.3.4.1. 剪枝-得到子树序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#交叉验证得到最优子树"><span class="nav-text">0.3.4.2. 交叉验证得到最优子树</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料："><span class="nav-text">0.4. 参考资料：</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">骚炼</span>

  

  
</div>






  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v4.2.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Mist</a> v6.4.1</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共46.8k字</span>
</div>
        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  










  





  

  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

    
  


  
  

  

  

  

  

  

</body>
</html>
